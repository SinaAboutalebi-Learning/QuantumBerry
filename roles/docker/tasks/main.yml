- name: Download Docker installation script (curl, TLS-safe)
  ansible.builtin.command:
    cmd: curl -fsSL https://get.docker.com -o /tmp/install-docker.sh
  args:
    creates: /tmp/install-docker.sh

- name: Make Docker install script executable
  ansible.builtin.file:
    path: /tmp/install-docker.sh
    mode: "0755"

- name: Run Docker installation script
  ansible.builtin.command:
    cmd: sh /tmp/install-docker.sh
  args:
    creates: /usr/bin/docker

- name: Cleanup Docker install script
  ansible.builtin.file:
    path: /tmp/install-docker.sh
    state: absent

- name: Ensure Docker service is started and enabled
  ansible.builtin.service:
    name: docker
    state: started
    enabled: true
